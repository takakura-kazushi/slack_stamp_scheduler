**Slack Bot: Stamp Scheduler - 要件定義書**

---

## 1. プロジェクト概要
Slackのリアクション(スタンプ)を用いて日程調整を簡単に行い、日程決定後は従ってリマインドを送信するSlackボット。

スタンプを押すだけで参加の表明ができ、最終的な日程を簡単に決めることができるUXを目指す。


## 2. 使用シーン
1. 師義がSlackに日程候補を投稿、このとき、botをメンションする。
    ```
    今週のミーティング候補日：
    :one: 月曜 10:00〜
    :two: 火曜 14:00〜
    :three: 水曜 16:00〜
    
    スタンプで出答お願いします！
    ```

2. 参加者が対応するスタンプを押す

3. 師義がスレッドで日程を決定、このとき、botをメンションする。
    ```
    日程は :two: 火曜 14:00〜 にします．
    ```

4. Botが決定されたスタンプに対応する参加者を特定

5. 日時が近づいたら自動リマインドを送信


## 3. 必須機能
### 3.1 候補日メッセージの投稿
- 師義が日程候補をテキストとスタンプで示礼

### 3.2 参加者の拾取
- `reaction_added`イベントを利用
- 候補メッセージに対してどのスタンプを押したかを記録

### 3.3 日程決定の検知
- `message` イベント（`thread_ts`あり）を監視
- テキストから決定されたスタンプ（例：:two:）を抽出

### 3.4 日時情報の確定
- 候補時に依存して決定

### 3.5 リマインド予約と送信
- APScheduler や cronなどを利用して定期利用
- `chat.postMessage`を使い参加者へDM送信


## 4. データベースデザイン
| フィールド | 内容 |
|------------|------|
| `main_message_ts` | 候補投稿メッセージのTS |
| `thread_ts` | スレッドのTS |
| `emoji_to_datetime` | { ":one:" : "2025-04-30T10:00", ":two:" : "2025-05-01T14:00" } |
| `selected_emoji` | 決定されたスタンプ（例：:two:） |
| `participants` | 対応スタンプを押したユーザIDリスト |
| `reminder_sent` | リマインド済フラグ |


## 5. 発展アイデア
- Google Calendar連携で自動登録
- 参加者数が一定以上になったら自動決定
- 複数チャンネル対応


## 6. 開発スタック
- 言語：Python (FastAPI)
- DB：SQLite (プロトタイプフェーズ), 後日クラウド化
- スケジューラ：APScheduler or 外部サービス Googleカレンダーを取り入れたい


## 7. 補訝
このBotは人間の決定と相互することを重視し、必要以上の自動化を行わない。「決定」メッセージは師義や管理者がする前提とする。

